<!doctype html>
<html>
<head>
<style>
body {
	margin: 0;
	padding: 0;
	background: #ddd;
	overflow: hidden;
}
input[type="radio"] {
	opacity: 0;
}
input[type="radio"] + label {
	-webkit-transition: all ease 0.4s;
	    -ms-transition: all ease 0.4s;
	   -moz-transition: all ease 0.4s;
	opacity: 0.5;
	font-weight: bold;
	cursor: pointer;
}
input[type="radio"]:focus + label {
	opacity: 1;
	margin-left: -5px;
}
.absolute {
	position: absolute;
}
.relative {
	position: relative;
}
.hidden {
	display: none;
}
.no-overflow {
	overflow: hidden;
}
.full-width {
	width: 100%;
}
.full-height {
	height: 100%;
}
.text-center {
	text-align: center;
}
.float-left {
	float: left;
}

.main {
	margin: 0 auto;
}
.main, .screen {
	width: 640px;
	height: 480px;
}
.game {
	margin-left: 32px;
	margin-top: 16px;
}
.game, .game-size {
	width: 384px;
	height: 448px;
}
.info {
	color: #eee;
	margin-top: 58px;
	margin-left: 432px;
}
.title {
	margin-top: 294px;
	margin-left: 446px;
	width: 168px;
	height: 168px;
}
.title .td {
	float: left;
	width: 56px;
	height: 56px;
}
.title .font {
	position: absolute;
	background-image: url(res/front.png);
	margin-left: -6px;
	margin-top: -6px;
	width: 64px;
	height: 64px;
	opacity: 0.6;
}
.font.fa.anim {
	-webkit-animation: fa_anim 2s linear;
	    -ms-animation: fa_anim 2s linear;
	   -moz-animation: fa_anim 2s linear;
}
@-webkit-keyframes fa_anim {
	from { -webkit-transform: rotate(360deg); opacity:0.0; margin-left: 48px; margin-top: 48px; }
	50%  { -webkit-transform: rotate(180deg); opacity:0.3; margin-left: 48px; margin-top:  0px; }
}
@-ms-keyframes fa_anim {
	from {     -ms-transform: rotate(360deg); opacity:0.0; margin-left: 48px; margin-top: 48px; }
	50%  {     -ms-transform: rotate(180deg); opacity:0.3; margin-left: 48px; margin-top:  0px; }
}
@-moz-keyframes fa_anim {
	from {    -moz-transform: rotate(360deg); opacity:0.0; margin-left: 48px; margin-top: 48px; }
	50%  {    -moz-transform: rotate(180deg); opacity:0.3; margin-left: 48px; margin-top:  0px; }
}
.font.fb.anim {
	-webkit-animation: fb_anim 1s linear;
	    -ms-animation: fb_anim 1s linear;
	   -moz-animation: fb_anim 1s linear;
}
@-webkit-keyframes fb_anim { from { -webkit-transform: rotate(-180deg); opacity:0.0; margin-top: 48px; } }
    @-ms-keyframes fb_anim { from {     -ms-transform: rotate(-180deg); opacity:0.0; margin-top: 48px; } }
   @-moz-keyframes fb_anim { from {    -moz-transform: rotate(-180deg); opacity:0.0; margin-top: 48px; } }
.font.fc.anim {
	-webkit-animation: fc_anim 1s linear;
	    -ms-animation: fc_anim 1s linear;
	   -moz-animation: fc_anim 1s linear;
}
@-webkit-keyframes fc_anim { from { -webkit-transform: rotate(180deg); opacity:0.0; margin-top: -60px; } }
    @-ms-keyframes fc_anim { from {     -ms-transform: rotate(180deg); opacity:0.0; margin-top: -60px; } }
   @-moz-keyframes fc_anim { from {    -moz-transform: rotate(180deg); opacity:0.0; margin-top: -60px; } }
.font.fd.anim {
	-webkit-animation: fd_anim 2s linear;
	    -ms-animation: fd_anim 2s linear;
	   -moz-animation: fd_anim 2s linear;
}
@-webkit-keyframes fd_anim {
	from { -webkit-transform: rotate(-360deg); opacity:0.0; margin-left: -60px; margin-top: -60px; }
	50%  { -webkit-transform: rotate(-180deg); opacity:0.3; margin-left: -60px; margin-top:   0px; }
}
@-ms-keyframes fd_anim {
	from {     -ms-transform: rotate(-360deg); opacity:0.0; margin-left: -60px; margin-top: -60px; }
	50%  {     -ms-transform: rotate(-180deg); opacity:0.3; margin-left: -60px; margin-top:   0px; }
}
@-moz-keyframes fd_anim {
	from {    -moz-transform: rotate(-360deg); opacity:0.0; margin-left: -60px; margin-top: -60px; }
	50%  {    -moz-transform: rotate(-180deg); opacity:0.3; margin-left: -60px; margin-top:   0px; }
}
.logo {
	margin-top: 312px;
	margin-left: 464px;
	width: 128px;
	height: 128px;
}
.logo.anim {
	-webkit-animation: logo_anim 5s;
	    -ms-animation: logo_anim 5s;
	   -moz-animation: logo_anim 5s;
}
@-webkit-keyframes logo_anim { from { -webkit-transform: rotate(-180deg);opacity:0; } }
    @-ms-keyframes logo_anim { from {     -ms-transform: rotate(-180deg);opacity:0; } }
   @-moz-keyframes logo_anim { from {    -moz-transform: rotate(-180deg);opacity:0; } }
.fps {
	margin-top: 10px;
	margin-left: 432px;
}
.mask {
	background: rgba(0, 0, 0, 0.7);
	color: #eee;
}
.loading {
	background: url(res/th06logo.png) white;
}
.bgimg>* {
	position: absolute;
	width: 384px;
	height: 480px;
}

.line {
	height: 24px;
}
.line-small {
	height: 20px;
}
.line-sep {
	height: 16px;
}
.label {
	float: left;
	width: 64px;
}
.label>* {
	background: url(res/front.png);
	height: 16px;
}
.label-max-point {
	width: 64px;
	background-position: 0 -192px;
}
.label-point {
	width: 32px;
	background-position: 0 -208px;
}
.label-player {
	width: 64px;
	background-position: 0 -176px;
}
.label-bomb {
	width: 48px;
	background-position: 0 -161px;
}
.label-power {
	width: 64px;
	background-position: -32px -208px;
}
.label-graze {
	width: 48px;
	background-position: -32px -224px;
}
.label-dot {
	width: 48px;
	background-position: -48px -160px;
}
.power-bar {
	margin-left: 64px;
	background: rgba(255,255,255,0.4);
	height: 16px;
	width: 128px;
}
.player {
	background: url(res/front.png) -32px -240px;
	float: left;
	width: 16px;
	height: 16px;
}
.bomb {
	background: url(res/front.png) -48px -240px;
	float: left;
	width: 16px;
	height: 16px;
}
.power-max {
	background: url(res/front.png) -64px -240px;
	float: left;
	width: 48px;
	height: 16px;
}
.num {
	background: url(res/ascii.png) 0 -32px;
	float: left;
	width: 14px;
	height: 16px;
}
.n0 {
	background-position: -0     -48px;
}
.n1 {
	background-position: -16px  -48px;
}
.n2 {
	background-position: -32px  -48px;
}
.n3 {
	background-position: -48px  -48px;
}
.n4 {
	background-position: -64px  -48px;
}
.n5 {
	background-position: -80px  -48px;
}
.n6 {
	background-position: -96px  -48px;
}
.n7 {
	background-position: -112px -48px;
}
.n8 {
	background-position: -128px -48px;
}
.n9 {
	background-position: -144px -48px;
}
</style>
</head>
<body>
<div id="res" class="hidden">
	<img id="player0L" src="res/player0.png" />
	<canvas id="player0R" from="player0L 0 48 256 48"
		transform="mirror:x"></canvas>
	<canvas id="bullet0" from="player0L 128 0 16 16"
		transform="rotate:{{range(180, 0, 10)}}"></canvas>
	<canvas id="bullet1" from="player0L 144 0 16 16"
		transform="rotate:{{range(90, 0, 15)}}"></canvas>
	<canvas id="onmyou" from="player0L 128 16 16 16"
		transform="rotate:{{range(360, 0, 20)}}"></canvas>
	<img id="etama2" src="res/etama2.png" />
	<img id="etama3" src="res/etama3.png" />
	<img id="etama4" src="res/etama4.png" />
	<img id="eff00" src="res/eff00.png" />
	<canvas id="effboss" from="eff00 16 48 16 16"
		transform="rotate:{{range(180, 0, 10)}}"></canvas>
	<canvas id="effbullet" from="player0L 128 32 16 16"
		transform="rotate:{{range(360, 0, 60)}}"></canvas>
	<canvas id="pslow" from="etama2 0 112 64 64"
		transform="rotate:{{range(90, 0, 6)}}"></canvas>
	<img id="stg1enm" src="res/stg1enm.png" />
	<img id="stg1bg" src="res/stg1bg.png" />
	<img id="front" src="res/front.png" />
	<canvas id="bombs" from="player0L 0 97 63 64"
		transform="colormask:White,DeepPink,DodgerBlue,SpringGreen"></canvas>
	<!-- -->
	<canvas id="mainbg_patt" from="front 0 224 32 32" bg-css=".main"></canvas>
	<!-- -->
	<canvas id="tree_pattL" from="stg1bg 0 48 64 128"
		transform="mirror:0,y" stack="y"></canvas>
	<canvas id="tree_pattR" from="tree_pattL"
		transform="mirror:x"></canvas>
	<canvas id="tree_bg_tmp" bg-css="#treebg"></canvas>
	<script id="gen_treebg">
		(function(RES) {
			var cv = RES.tree_bg_tmp,
				dc = getCanvasDC(cv),
				elem = $e('treebg');
			cv.width = parseInt($style(elem, 'width'));
			cv.height = parseInt($style(elem, 'height'));

			ieach([RES.tree_pattL, RES.tree_pattR], function mkRepeatTexture(i, patt) {
				var sw = patt.width,
					h = patt.height / 2,
					f = random(1),
					x = i && (cv.width - patt.width),
					y = 0;
				while (y < cv.height) {
					var g = random(1);
						sy = (g > f ? f : 2 - f) * h,
						sh = Math.abs(g - f) * h;
					dc.drawImage(patt, 0, sy, sw, sh, x, y, sw, sh);

					f = g;
					y += sh;
				}
			});

			var rh = parseInt($style('.game', 'height'));
			dc.repeatSelf(0, cv.height - rh, cv.width, rh, 0, 0);
		})
	</script>
	<!-- -->
	<canvas id="ground_patt" from="stg1bg 0 0 64 32"></canvas>
	<canvas id="ground_pattX" class="ground_patt" from="stg1bg 64 0 16 16"></canvas>
	<canvas id="ground_patt0" class="ground_patt" from="stg1bg 64 0 16 16"></canvas>
	<canvas id="ground_patt1" class="ground_patt" from="stg1bg 80 0 16 16"></canvas>
	<canvas id="ground_patt2" class="ground_patt" from="stg1bg 96 0 32 16"></canvas>
	<canvas id="ground_patt3" class="ground_patt" from="stg1bg 64 16 16 16"></canvas>
	<canvas id="ground_patt4" class="ground_patt" from="stg1bg 80 16 28 16"></canvas>
	<canvas id="ground_patt5" class="ground_patt" from="stg1bg 108 16 20 16"></canvas>
	<canvas id="ground_tileB" from="stg1bg 128 0 64 18"></canvas>
	<canvas id="ground_tileT" from="ground_tileB" transform="rotate:180"></canvas>
	<canvas id="ground_brush0" from="stg1bg 208 48 48 16" transform="0,0"></canvas>
	<canvas id="ground_brush1" from="ground_brush0" transform="offset:0 0,24 0" stack="y"></canvas>
	<canvas id="ground_brush2" from="ground_brush1 0 0 48 32"></canvas>
	<canvas id="ground_bg_tmp" bg-css="#groundbg"></canvas>
	<script id="gen_groundbg">
		(function(RES) {
			var cv = RES.ground_bg_tmp,
				dc = getCanvasDC(cv),
				patt = RES.ground_patt,
				elem = $e('groundbg');
			cv.width = parseInt($style(elem, 'width'));
			cv.height = parseInt($style(elem, 'height'));
			dc.fillWith(dc.createPattern(patt, 'repeat'));

			for (var y = 0; y < cv.height; y += patt.height) {
				var cx = random(0.3, 0.7) * cv.width,
					cy = random(patt.height) + y;
					sc = randin($('canvas.ground_patt'));
				dc.drawImage(sc, cx, cy);
			}

			var sc = RES.ground_tileT,
				brA = 'rgb(57, 49, 94)',
				brB = dc.createPattern(RES.ground_brush2, 'repeat'),
				py = 800, ph = 200;
			for (var x = 0, y = py; x < cv.width; x += sc.width, y -= sc.height) {
				dc.clearRect(x, y, sc.width, ph);
				dc.fillStyle = brA;
				dc.fillRect(x, y, sc.width, ph);
				dc.fillStyle = brB;
				dc.fillRect(x, y, sc.width, ph);
				dc.drawImage(RES.ground_tileT, x, y);
				dc.drawImage(RES.ground_tileB, x, y + ph - sc.height);
			}

			var bg = RES.tree_bg_tmp,
				hw = bg.width / 2,
				dw = bg.width * 0.1;
			dc.globalAlpha = 0.4;
			dc.drawImage(bg, 0, 0, hw, bg.height, dw, cv.height - bg.height, hw, bg.height);
			dc.drawImage(bg, hw, 0, hw, bg.height, hw-dw, cv.height - bg.height, hw, bg.height);
			dc.globalAlpha = 1;

			var rh = parseInt($style('.game', 'height'));
			dc.repeatSelf(0, cv.height - rh, cv.width, rh, 0, 0);

			/*
			 * for debug only
			 */
			range(cv.height, 0, 200, function(y) {
				dc.beginPath();
				dc.moveTo(0, y);
				dc.lineTo(cv.width, y);
				dc.closePath();
				dc.stroke();
				dc.fillStyle = 'black';
				dc.fillText(y, cv.width/2, y);
			});
		})
	</script>
	<!-- -->
	<canvas id="logo_patt" from="front 128 128 128 128" bg-css=".logo"></canvas>
	<!-- -->
	<script id="gen_bgcss">
		(function(RES) {
			/*
			 * canvas.toDataURL() will not work in chrome when the html file is opened in a local disk
			 * see http://stackoverflow.com/questions/10187306/canvas-todataurl-throws-security-exception-despite-image-being-local
			 */
			ieach($('canvas[bg-css]'), function(i, cv, ss) {
				var s = $attr(cv, 'bg-css'),
					r = 'background: url(' + cv.toDataURL() + ')';
				ss.addRule ? ss.addRule(s, r) : ss.insertRule(s+' {'+r+'}', ss.cssRules.length);
			}, document.styleSheets[0]);
		})
	</script>
	<!-- -->
	<script id="frames">
		(function(RES) {
			var _t = {};

			_t.Player0 = array(4, function(i) {
				return extend({ res:'player0L', sy: 0, sw:32, sh:48, w:32, h:48 }, { sx:32*i });
			});
			_t.PlayerL = array(7, function(i) {
				return extend({ res:'player0L', sy:48, sw:32, sh:48, w:32, h:48 }, { sx:32*i });
			});
			_t.PlayerR = array(7, function(i) {
				return extend({ res:'player0R', sy:0, sw:32, sh:48, w:32, h:48 }, { sx:255-32*(i+1) });
			});
			_t.PlayerD = [
				{ res:'player0L', sx:0, sy: 0, sw:32, sh:48, w:32, h:48 },
				{ res:'player0L', sx:0, sy: 0, sw:32, sh:48, w:30, h:50 },
				{ res:'player0L', sx:0, sy: 0, sw:32, sh:48, w:27, h:53 },
				{ res:'player0L', sx:0, sy: 0, sw:32, sh:48, w:22, h:58 },
				{ res:'player0L', sx:0, sy: 0, sw:32, sh:48, w:15, h:63 },
				{ res:'player0L', sx:0, sy: 0, sw:32, sh:48, w:5, h:73 },
				{ res:'player0L', sx:0, sy: 0, sw:32, sh:48, w:1, h:93 },
				{ res:'player0L', sx:0, sy: 0, sw:0, sh:0, w:0, h:0 },
			];

			_t.Bullet0 = array(RES.bullet0.width/16, function(i) {
				return extend({ res:'bullet0', sy:0, sw:16, sh:16, w:16, h:16 }, { sx:16*i });
			});
			_t.Bullet1 = array(RES.bullet1.width/16, function(i) {
				return extend({ res:'bullet1', sy:0, sw:16, sh:16, w:16, h:16 }, { sx:16*i });
			});
			_t.BulletD = [
				{ res:'player0L', sx:160, sy: 0, sw:16, sh:16, w:16, h:16 },
				{ res:'player0L', sx:176, sy: 0, sw:16, sh:16, w:16, h:16 },
			];
			_t.Onmyou = array(RES.onmyou.width/16, function(i) {
				return extend({ res:'onmyou', sy:0, sw:16, sh:16, w:16, h:16 }, { sx:16*i });
			});
			_t.OnmyouR = array(RES.onmyou.width/16, function(i) {
				return extend({ res:'onmyou', sy:0, sw:16, sh:16, w:16, h:16 }, { sx:RES.onmyou.width-16-16*i });
			});
			_t.PSlow = array(RES.pslow.width/64, function(i) {
				return extend({ res:'pslow', sy:0, sw:64, sh:64, w:64, h:64 }, { sx:64*i });
			});
			_t.Shield = array(RES.bombs.width/63, function(i) {
				return extend({ res:'bombs', sy:0, sw:60, sh:60, w:120, h:120 }, { sx:63*i });
			});

			ieach(['Drops', 'Lasers', 'TamaA', 'TamaB', 'LongA', 'LongB', 'LongC'], function(i, k) {
				_t[k] = array(16, function(j) {
					return { res:'etama3', sx:16*j, sy:i*16, sw:16, sh:16, w:16, h:16, rotate:k.indexOf('Long')==0 }
				});
			});
			_t.TamaLarge = array(8, function(i) {
				return { res:'etama3', sx:32*i, sy:128, sw:32, sh:32, w:32, h:32 }
			});

			ieach([0, 128], function(i, x) {
				ieach([0, 32, 64], function(j, y) {
					_t['Enemy'+i+j] = array(4, function(i) {
						return extend({ res:'stg1enm', sy:y, sw:32, sh:32, w:32, h:32 }, { sx:x+32*i });
					});
				});
			});
			_t.EnemyX = array(8, function(i) {
				return extend({ res:'stg1enm', sy:255-48, sw:32, sh:48, w:32, h:48 }, { sx:32*i });
			});

			_t.EffBullet = array(RES.effbullet.width/16, function(i) {
				return { res:'effbullet', sx:i*16, sy:0, sw:16, sh:16, w:16, h:16 };
			});
			_t.EffBoss = array(RES.effboss.width/16, function(i) {
				return { res:'effboss', sx:i*16, sy:0, sw:16, sh:16, w:16, h:16 };
			});
			_t.EffEnemy = ieach([32,42,52,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26], function(i, d, ls) {
				ls.push(extend({ res:'eff00', sx:32, sy:0, sw:32, sh:32, rotate:-i*0.5 }, { w:d, h:d }));
			}, []);
			_t.EffPlayer = ieach([32,42,52,62,67,72,76,80,83,86,89,92,95,98,101,104,107,110,113,116,119,122], function(i, d, ls) {
				ls.push(extend({ res:'eff00', sx:0, sy:0, sw:32, sh:32 }, { w:d*1.5, h:d*1.5 }));
			}, []);
			ieach(['EffPiece', 'EffPieceR', 'EffPieceG', 'EffPieceB'], function(i, k) {
				_t[k] = array(4, function(j) {
					return { res:'eff00', sx:i*64+j*16, sy:32, sw:16, sh:16, w:16, h:16 };
				});
			});

			return _t;
		})
	</script>
	<!-- -->
	<img id="ascii" src="res/ascii.png" />
	<canvas id="ascii_yellow" from="ascii"
		transform="colormap:l->rgb(255,255,64)"></canvas>
	<script id="fontmap">
		(function(RES) {
			var _t = {
				cw: 16,
				ch: 16,
			}
			ieach([
				' !"#$%&\'()*+,-./',
				'0123456789:;<=>?',
				'@ABCDEFGHIJKLMNO',
				'PQRSTUVWXYZ[`]`_',
				' abcdefghijklmno',
				'pqrstuvwxyz(|)~`',
			], function(i, s) {
				ieach(s, function(j, c) {
					_t[c] = {
						x: j * _t.cw,
						y: i * _t.ch + 32,
					};
				});
			});
			return _t;
		})
	</script>
	<!-- -->
	<canvas id="num" from="ascii 0 48 256 16"></canvas>
	<canvas id="num0" from="num"
		transform="colormap:l->rgb(123,192,249)"></canvas>
	<canvas id="num1" from="num"
		transform="colormap:l->rgb(155,120,240)"></canvas>
	<canvas id="num2" from="num"
		transform="colormap:l->rgb(224,128,192)"></canvas>
	<canvas id="num3" from="num"
		transform="colormap:l->rgb(255,64,64)"></canvas>
	<script id="nummap">
		(function(RES) {
			var _t = {
				cw: 16,
				ch: 16,
			}
			ieach('0123456789', function(j, c) {
				_t[c] = {
					x: j * _t.cw,
					y: 0,
				};
			});
			return _t;
		})
	</script>
</div>
<div class="main">
	<div class="game absolute no-overflow" style="z-index:0">
		<!-- add no-overflow to fix issue in Firefox -->
		<div class="game-size absolute bgimg no-overflow"
			id="bg0">
			<div class="ui-obj bg1" style="height:2400px;"
				id="groundbg" bg-speed="0.01"></div>
			<div class="ui-obj bg1"
				style="height:400px;background:linear-gradient(rgba(0,0,0,0.6),transparent)"></div>
		</div>
		<div class="game-size absolute bgimg no-overflow"
			id="bg1">
			<div class="ui-obj bg1" style="height:1000px;"
				id="treebg" bg-speed="0.015"></div>
			<div class="ui-obj bg1"
				style="height:300px;background:linear-gradient(rgba(0,0,0,0.6),transparent)"></div>
		</div>
		<div class="game-size absolute ui-obj bombbg" style="background:rgba(0,0,0,0.6)"></div>
	</div>
	<canvas class="game absolute" id="canv"></canvas>
	<div class="info absolute">
		<div class="line">
			<div class="label"><div class="label-max-point"></div></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.max_point+1e9, 1)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.max_point+1e9, 2)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.max_point+1e9, 3)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.max_point+1e9, 4)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.max_point+1e9, 5)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.max_point+1e9, 6)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.max_point+1e9, 7)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.max_point+1e9, 8)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.max_point+1e9, 9)" ui-bind-attr="this.className"></div>
		</div>
		<div class="line">
			<div class="label"><div class="label-point"></div></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.point+1e9, 1)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.point+1e9, 2)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.point+1e9, 3)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.point+1e9, 4)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.point+1e9, 5)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.point+1e9, 6)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.point+1e9, 7)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.point+1e9, 8)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.point+1e9, 9)" ui-bind-attr="this.className"></div>
		</div>
		<div class="line-sep"></div>
		<div class="line">
			<div class="label"><div class="label-player"></div></div>
			<div class="ui player" ui-show="STATICS.player > 0"></div>
			<div class="ui player" ui-show="STATICS.player > 1"></div>
			<div class="ui player" ui-show="STATICS.player > 2"></div>
			<div class="ui player" ui-show="STATICS.player > 3"></div>
			<div class="ui player" ui-show="STATICS.player > 4"></div>
			<div class="ui player" ui-show="STATICS.player > 5"></div>
			<div class="ui player" ui-show="STATICS.player > 6"></div>
		</div>
		<div class="line">
			<div class="label"><div class="label-bomb"></div></div>
			<div class="ui bomb" ui-show="STATICS.bomb > 0"></div>
			<div class="ui bomb" ui-show="STATICS.bomb > 1"></div>
			<div class="ui bomb" ui-show="STATICS.bomb > 2"></div>
			<div class="ui bomb" ui-show="STATICS.bomb > 3"></div>
			<div class="ui bomb" ui-show="STATICS.bomb > 4"></div>
			<div class="ui bomb" ui-show="STATICS.bomb > 5"></div>
			<div class="ui bomb" ui-show="STATICS.bomb > 6"></div>
		</div>
		<div class="line-sep"></div>
		<div class="line-small">
			<div class="power-bar absolute ui" ui-bind="STATICS.power*0.5+'px'" ui-bind-attr="this.style.width"></div>
			<div class="label"><div class="label-power"></div></div>
			<div class="ui float-left" ui-show="STATICS.power < 255">
				<div class="ui" ui-bind="'ui num n'+getNum(STATICS.power, 0)" ui-bind-attr="this.className"></div>
				<div class="ui" ui-bind="'ui num n'+getNum(STATICS.power, 1)" ui-bind-attr="this.className"></div>
				<div class="ui" ui-bind="'ui num n'+getNum(STATICS.power, 2)" ui-bind-attr="this.className"></div>
			</div>
			<div class="ui power-max" ui-show="STATICS.power >= 255"></div>
		</div>
		<div class="line-small">
			<div class="label"><div class="label-graze"></div></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.graze, 0)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.graze, 1)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.graze, 2)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.graze, 3)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.graze, 4)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.graze, 5)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.graze, 6)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.graze, 7)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.graze, 8)" ui-bind-attr="this.className"></div>
		</div>
		<div class="line-small">
			<div class="label"><div class="label-dot"></div></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.dot, 0)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.dot, 1)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.dot, 2)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.dot, 3)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.dot, 4)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.dot, 5)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.dot, 6)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.dot, 7)" ui-bind-attr="this.className"></div>
			<div class="ui" ui-bind="'ui num n'+getNum(STATICS.dot, 8)" ui-bind-attr="this.className"></div>
		</div>
	</div>
	<div class="logo absolute"></div>
	<div class="title absolute">
		<div class="tr">
			<div class="td"><div class="font fa" style="background-position:0 0;"></div></div>
			<div class="td"><div class="font fb" style="background-position:-64px 0;"></div></div>
			<div class="td"></div>
		</div>
		<div class="tr">
			<div class="td"></div>
			<div class="td"><div class="font" style="background-position:-128px 0;opacity:1"></div></div>
			<div class="td"></div>
		</div>
		<div class="tr">
			<div class="td"></div>
			<div class="td"><div class="font fc" style="background-position:-192px 0;"></div></div>
			<div class="td"><div class="font fd" style="background-position:0 -64px;"></div></div>
		</div>
	</div>
	<div class="screen mask absolute ui" ui-show="GAME.state == GAME.states.PAUSE">
		<strong><big><p class="ui text-center" ui-bind="keyfind(GAME.states, GAME.state)"></p></big></strong>
		<form action="javascript:eval(getRadioVal($('input[name=pause_menu]')))">
			<p><input type="radio" name="pause_menu" value="GAME.state = GAME.states.RUNNING"><label>Continue</label></p>
			<!--p><input type="radio" name="pause_menu" value=""><label>Back to Title</label></p-->
			<p><input type="radio" name="pause_menu" value="loadAndStart()"><label>Restart</label></p>
			<p><input type="radio" name="pause_menu" value="window.close()"><label>Quit</label></p>
			<input style="width:0px;opacity:0;" type="submit" />
		</form>
	</div>
	<div class="fps absolute" style="color:white">
		<div>fps: <span class="ui" ui-bind="GAME.fps.toFixed(2)+' / '+GAME.tick"></span></div>
		<div>story: <span class="ui" ui-bind="STORY.state.n"></span></div>
	</div>
	<div class="screen loading absolute ui" ui-show="RES.process < 1">
		<h3>loading <span class="ui" ui-bind="(RES.process*100).toFixed(1)+'%'">...</span></h3>
	</div>
</div>
<div class="ui" ui-bind="GAME.state" ui-bind-exec="setTimeout(checkRadios, 100)"></div>
<script src="game.js"></script>
<script>
ieach($('input[type="radio"]'), function(i, v) {
	var n = v.nextElementSibling;
	if (n && n.tagName == 'LABEL' && !v.id) {
		n.setAttribute('for', v.id = 'radio'+i);
		n.addEventListener('mouseup', function(e) {
			// have to wait before radios changed
			setTimeout(function() {
				v.form.submit();
			}, 10);
		});
	}
});
ieach($('.ui-obj'), function(i, v) {
	v.className += ' ui';
	v.setAttribute('ui-show', 'this.object && !this.object.finished');
});

function checkRadios() {
	var ls = $('input[type="radio"]');
	var r = ieach(ls, function(i, v) {
		if (v.scrollHeight > 0 && v.checked)
			return v;
	}, ls[0]);
	if (r) {
		r.checked = true;
		r.focus();
	}
}

function getRadioVal(ls) {
	return ieach(ls, function(i, v) {
		if (v.checked) return v.value;
	});
}

function getNum(n, i) {
	return (n + '').substr(i, 1);
}

function getCanvasDC(cv) {
	var dc = cv.getContext('2d');
	dc.fillWith = function(patt) {
		if (patt)
			dc.fillStyle = patt;
		dc.fillRect(0, 0, cv.width, cv.height);
	};
	dc.repeatSelf = function(sx, sy, sw, sh, x, y, w, h) {
		w = w || sw;
		h = h || sh;
		dc.clearRect(x, y, w, h);
		dc.drawImage(cv, sx, sy, sw, sh, x, y, w, h);
	};
	return dc;
}

function reAddClass(e, c) {
	e.classList.remove(c);
	// MAGIC!
	e.offsetWidth = e.offsetWidth;
	e.classList.add(c);
}

function loadAndStart() {
	GAME.load(tl, hook);
	GAME.start('init');
	ieach($('.logo, .font'), function(i, e) {
		reAddClass(e, 'anim');
	});
}
RES.check(loadAndStart);

</script>
</body>
</html>
