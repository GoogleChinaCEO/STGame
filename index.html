<!doctype html>
<html>
<head>
<style>
body {
	margin: 0;
	padding: 0;
	background: #ddd;
	color: #eee;
}
.absolute {
	position: absolute;
}
.hidden {
	display: none;
}
.full-width {
	width: 100%;
}
.text-center {
	text-align: center;
}
#canv {
	background: url(res/bg.png);
}
</style>
</head>
<body>
<div id="res" class="hidden">
	<img id="player0L" src="res/player0.png" />
	<canvas id="player0R" from="player0L 0 48 256 48"
		transform="mirror:x"></canvas>
	<canvas id="bullet0" from="player0L 128 0 16 16"
		transform="rotate:30"></canvas>
	<canvas id="bullet1" from="player0L 144 0 16 16"
		transform="rotate:0,15,30,45,60,75"></canvas>
	<canvas id="onmyou" from="player0L 128 16 16 16"
		transform="rotate:0,20,40,80,100,120,140,160,180,200,220,240,260,280,300,320,340"></canvas>
	<img id="etama3" src="res/etama3.png" />
	<img id="etama4" src="res/etama4.png" />
	<img id="eff00" src="res/eff00.png" />
	<canvas id="effboss" from="eff00 16 48 16 16"
		transform="rotate:0,10,20,40,50,60,70,80,90,100,110,120,130,140,150,160,170"></canvas>
	<img id="stg1enm" src="res/stg1enm.png" />
	<script id="frames">
		(function() {
			var _t = {};

			_t.Player0 = array(4, function(i) {
				return extend({ res:'player0L', sy: 0, sw:32, sh:48, w:32, h:48 }, { sx:32*i });
			});
			_t.PlayerL = arrcat([
				{ res:'player0L', sx: 0, sy:0, sw:32, sh:48, w:32, h:48 },
				{ res:'player0L', sx:32, sy:0, sw:32, sh:48, w:32, h:48 },
			], array(7, function(i) {
				return extend({ res:'player0L', sy:48, sw:32, sh:48, w:32, h:48 }, { sx:32*i });
			}));
			_t.PlayerR = arrcat([
				{ res:'player0L', sx: 0, sy:0, sw:32, sh:48, w:32, h:48 },
				{ res:'player0L', sx:32, sy:0, sw:32, sh:48, w:32, h:48 },
			], array(7, function(i) {
				return extend({ res:'player0R', sy:0, sw:32, sh:48, w:32, h:48 }, { sx:255-32*(i+1) });
			}));

			_t.Bullet0 = [
				{ res:'bullet0', sx:0, sy:0, sw:16, sh:16, w:16, h:16 },
			];
			_t.Bullet1 = array(6, function(i) {
				return extend({ res:'bullet1', sy:0, sw:16, sh:16, w:16, h:16 }, { sx:16*i });
			});
			_t.Onmyou = array(16, function(i) {
				return extend({ res:'onmyou', sy:0, sw:16, sh:16, w:16, h:16 }, { sx:16*i });
			});

			array(8, function(i) {
				_t['TamaL'+i] = [
					{ res:'etama3', sx:i*32, sy:128, sw:32, sh:32, w:32, h:32 }
				]
			});
			_t.Tama3 = [
				{ res:'etama3', sx:0, sy:64, sw:16, sh:16, w:16, h:16, rotate:true },
			];
			_t.Drop = [
				{ res:'etama3', sx:32, sy:0, sw:16, sh:16, w:20, h:20 },
			];
			_t.DropSmall = [
				{ res:'etama3', sx:16, sy:0, sw:16, sh:16, w:20, h:20 },
			];

			var j = 0;
			ieach([0, 128], function(i, x) {
				ieach([0, 32, 64], function(i, y) {
					_t['Enemy'+(j++)] = array(4, function(i) {
						return extend({ res:'stg1enm', sy:y, sw:32, sh:32, w:32, h:32 }, { sx:x+32*i });
					});
				});
			});
			_t.EnemyX = array(8, function(i) {
				return extend({ res:'stg1enm', sy:255-48, sw:32, sh:48, w:32, h:48 }, { sx:32*i });
			});

			_t.EffBoss = array(16, function(i) {
				return { res:'effboss', sx:i*16, sy:0, sw:16, sh:16, w:16, h:16 };
			});
			_t.EffEnm = ieach([32,42,52,62,60,58,56,54,52,50,48,46,44,42,40,38,36,34,32,30,28,26], function(i, d, ls) {
				ls.push(extend({ res:'eff00', sx:0, sy:0, sw:32, sh:32 }, { w:d, h:d }));
			}, []);

			return _t;
		})
	</script>
</div>
<div class="absolute full-width">
	<div>fps: <span class="ui" ui-bind="GAME.fps.toFixed(3)"></span></div>
	<div>story: <span class="ui" ui-bind="STORY.state.n"></span></div>
	<div>graze: <span class="ui" ui-bind="GAME.statics.graze"></span></div>
	<div>point: <span class="ui" ui-bind="GAME.statics.point"></span></div>
	<div>miss: <span class="ui" ui-bind="GAME.statics.miss"></span></div>
	<div class="ui" ui-show="RES.process < 1">
		loading: <span class="ui" ui-bind="(RES.process*100).toFixed(1)+'%'"></span>
	</div>
	<div class="text-center ui" ui-show="GAME.state != GAME.states.RUNNING">
		<big class="ui" ui-bind="keyfind(GAME.states, GAME.state)"></big>
	</div>
</div>
<canvas ui-bind="GAME.statics.time*0.05+'px'" ui-bind-attr="this.style['background-position-y']"
	id="canv" class="ui" width="320px" height="480px"></canvas>
<script src="game.js"></script>
</body>
</html>
